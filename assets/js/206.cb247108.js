(window.webpackJsonp=window.webpackJsonp||[]).push([[206],{440:function(t,a,s){"use strict";s.r(a);var r=s(0),_=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"第五章：事务的传播"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第五章：事务的传播"}},[t._v("#")]),t._v(" 第五章：事务的传播")]),t._v(" "),s("h2",{attrs:{id:"一-事务的种类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-事务的种类"}},[t._v("#")]),t._v(" 一. 事务的种类")]),t._v(" "),s("h3",{attrs:{id:"_1-required"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-required"}},[t._v("#")]),t._v(" 1. REQUIRED")]),t._v(" "),s("ul",[s("li",[t._v("使用当前的事务，如果当前没有事务，则自己新建一个事务，子方法是必须运行在一个事务中的")]),t._v(" "),s("li",[t._v("如果当前存在事务，则加入这个事务，成为一个整体")]),t._v(" "),s("li",[t._v("常用于"),s("code",[t._v("增删改")]),t._v("操作")])]),t._v(" "),s("p",[s("strong",[t._v("举例：")])]),t._v(" "),s("blockquote",[s("p",[t._v("领导没饭吃，我有钱，我会自己买了自己吃；领导有的吃，会分给我一起吃")])]),t._v(" "),s("h3",{attrs:{id:"_2-supports"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-supports"}},[t._v("#")]),t._v(" 2. SUPPORTS")]),t._v(" "),s("ul",[s("li",[t._v("如果当前有事务，则使用事务；如果当前没有事务，则不使用事务")]),t._v(" "),s("li",[t._v("常用于"),s("code",[t._v("查询")]),t._v("操作")])]),t._v(" "),s("p",[s("strong",[t._v("举例：")])]),t._v(" "),s("blockquote",[s("p",[t._v("领导没饭吃，我也没饭吃；领导有饭吃，我也有饭吃")])]),t._v(" "),s("h3",{attrs:{id:"_3-mandatory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-mandatory"}},[t._v("#")]),t._v(" 3. MANDATORY")]),t._v(" "),s("ul",[s("li",[t._v("该传播属性强制必须存在一个事务，如果不存在，则抛出异常")]),t._v(" "),s("li",[t._v("IllegalTransactionStateException:No existing transaction found for transaction marked with propagation 'mandatory'")])]),t._v(" "),s("p",[s("strong",[t._v("举例：")])]),t._v(" "),s("blockquote",[s("p",[t._v("领导必须管饭，不管饭，没饭吃，我就不乐意了，就不干了（抛出异常）")])]),t._v(" "),s("h3",{attrs:{id:"_4-requires-new"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-requires-new"}},[t._v("#")]),t._v(" 4. REQUIRES_NEW")]),t._v(" "),s("ul",[s("li",[t._v("如果当前有事务，则挂起该事务，并且自己创建一个新的事务给自己使用")]),t._v(" "),s("li",[t._v("如果当前没有事务，则同 REQUIRED")])]),t._v(" "),s("p",[s("strong",[t._v("举例：")])]),t._v(" "),s("blockquote",[s("p",[t._v("领导有饭吃，我偏不要，我自己买了自己吃")])]),t._v(" "),s("h3",{attrs:{id:"_5-not-supported"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-not-supported"}},[t._v("#")]),t._v(" 5. NOT_SUPPORTED")]),t._v(" "),s("ul",[s("li",[t._v("如果当前有事务，则把事务挂起，自己不适用事务去运行数据库操作")])]),t._v(" "),s("p",[s("strong",[t._v("举例：")])]),t._v(" "),s("blockquote",[s("p",[t._v("领导有饭吃，分一点给你，我太忙了，放一边，我不吃")])]),t._v(" "),s("h3",{attrs:{id:"_6-never"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-never"}},[t._v("#")]),t._v(" 6. NEVER")]),t._v(" "),s("ul",[s("li",[t._v("如果当前有事务存在，则抛出异常")]),t._v(" "),s("li",[t._v("IllegalTransactionStateException:No existing transaction found for transaction marked with propagation 'never'")])]),t._v(" "),s("p",[s("strong",[t._v("举例：")])]),t._v(" "),s("blockquote",[s("p",[t._v("领导有饭给你吃，我不想吃，我热爱工作，我抛出异常")])]),t._v(" "),s("h3",{attrs:{id:"_7-nested"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-nested"}},[t._v("#")]),t._v(" 7. NESTED")]),t._v(" "),s("ul",[s("li",[t._v("如果当前有事务，则开启子事务（嵌套事务），嵌套事务是独立提交或者回滚")]),t._v(" "),s("li",[t._v("如果当前没有事务，则同 REQUIRED")]),t._v(" "),s("li",[t._v("但是如果主事务提交，则会携带子事务一起提交")]),t._v(" "),s("li",[t._v("如果主事务回滚，则子事务会一起回滚。相反，子事务异常，则父事务可以回滚或不回滚")])]),t._v(" "),s("p",[s("strong",[t._v("举例：")])]),t._v(" "),s("blockquote",[s("p",[t._v("领导决策不对，老板怪罪，领导带着小弟一同受罪。小弟出了差错，领导可以推卸责任")])]),t._v(" "),s("h2",{attrs:{id:"二-事务的传播"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-事务的传播"}},[t._v("#")]),t._v(" 二. 事务的传播")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("REQUIRED 将父方法和子方法的事务合并成一个事务，如果有一个报错则全部回滚")])]),t._v(" "),s("li",[s("p",[t._v("REQUIRES_NEW 会为方法加一个新的事务。如果该事务添加在子方法上，那么假如父方法有REQUIRED事务报错回滚，而子方法照样保存提交成功")])]),t._v(" "),s("li",[s("p",[t._v("NESTED 嵌套父子事务是两个事务，父子事务一起提交或回滚的。同时子事务可以被try/catch住，父事务不受影响")])])]),t._v(" "),s("h2",{attrs:{id:"三-事务的使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三-事务的使用方法"}},[t._v("#")]),t._v(" 三. 事务的使用方法")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// default")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Transactional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propagation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Propagation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("REQUIRED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("h2",{attrs:{id:"四-为什么不需要启动类开启事务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四-为什么不需要启动类开启事务"}},[t._v("#")]),t._v(" 四. 为什么不需要启动类开启事务")]),t._v(" "),s("ul",[s("li",[t._v("springboot自动装配的时候已经加载")]),t._v(" "),s("li",[t._v("@SpringBootApplication -> @EnableAutoConfiguration -> AutoConfigurationImportSeletor.class\n-> spring.factories -> TransactionAutoConfiguration")])]),t._v(" "),s("comment")],1)}),[],!1,null,null,null);a.default=_.exports}}]);